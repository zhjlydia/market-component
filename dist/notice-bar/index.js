import { SpuiComponent } from '../common/component';
const FONT_COLOR = '#ed6a0c';
const BG_COLOR = '#fffbe8';
SpuiComponent({
  props: {
    text: {
      type: String,
      value: ''
    },
    mode: {
      type: String,
      value: ''
    },
    url: {
      type: String,
      value: ''
    },
    openType: {
      type: String,
      value: 'navigate'
    },
    delay: {
      type: Number,
      value: 0
    },
    speed: {
      type: Number,
      value: 50
    },
    scrollable: {
      type: Boolean,
      value: true
    },
    leftIcon: {
      type: String,
      value: ''
    },
    color: {
      type: String,
      value: FONT_COLOR
    },
    backgroundColor: {
      type: String,
      value: BG_COLOR
    }
  },
  data: {
    show: true,
    hasRightIcon: false,
    width: undefined,
    wrapWidth: undefined,
    elapse: undefined,
    animation: null,
    resetAnimation: null,
    timer: null
  },
  watch: {
    text() {
      this.set({}, this.init);
    }

  },

  created() {
    if (this.data.mode) {
      this.set({
        hasRightIcon: true
      });
    }
  },

  destroyed() {
    const {
      timer
    } = this.data;
    timer && clearTimeout(timer);
  },

  methods: {
    init() {
      this.getRect('.spui-notice-bar__content').then(rect => {
        if (!rect || !rect.width) {
          return;
        }

        this.set({
          width: rect.width
        });
        this.getRect('.spui-notice-bar__content-wrap').then(rect => {
          if (!rect || !rect.width) {
            return;
          }

          const wrapWidth = rect.width;
          const {
            width,
            speed,
            scrollable,
            delay
          } = this.data;

          if (scrollable && wrapWidth < width) {
            const elapse = width / speed * 1000;
            const animation = wx.createAnimation({
              duration: elapse,
              timeingFunction: 'linear',
              delay
            });
            const resetAnimation = wx.createAnimation({
              duration: 0,
              timeingFunction: 'linear'
            });
            this.set({
              elapse,
              wrapWidth,
              animation,
              resetAnimation
            }, () => {
              this.scroll();
            });
          }
        });
      });
    },

    scroll() {
      const {
        animation,
        resetAnimation,
        wrapWidth,
        elapse,
        speed
      } = this.data;
      resetAnimation.translateX(wrapWidth).step();
      const animationData = animation.translateX(-(elapse * speed) / 1000).step();
      this.set({
        animationData: resetAnimation.export()
      });
      setTimeout(() => {
        this.set({
          animationData: animationData.export()
        });
      }, 100);
      const timer = setTimeout(() => {
        this.scroll();
      }, elapse);
      this.set({
        timer
      });
    },

    onClickIcon() {
      const {
        timer
      } = this.data;
      timer && clearTimeout(timer);
      this.set({
        show: false,
        timer: null
      });
    },

    onClick(event) {
      this.$emit('click', event);
    }

  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vdGljZS1iYXIvaW5kZXgudHMiXSwibmFtZXMiOlsiU3B1aUNvbXBvbmVudCIsIkZPTlRfQ09MT1IiLCJCR19DT0xPUiIsInByb3BzIiwidGV4dCIsInR5cGUiLCJTdHJpbmciLCJ2YWx1ZSIsIm1vZGUiLCJ1cmwiLCJvcGVuVHlwZSIsImRlbGF5IiwiTnVtYmVyIiwic3BlZWQiLCJzY3JvbGxhYmxlIiwiQm9vbGVhbiIsImxlZnRJY29uIiwiY29sb3IiLCJiYWNrZ3JvdW5kQ29sb3IiLCJkYXRhIiwic2hvdyIsImhhc1JpZ2h0SWNvbiIsIndpZHRoIiwidW5kZWZpbmVkIiwid3JhcFdpZHRoIiwiZWxhcHNlIiwiYW5pbWF0aW9uIiwicmVzZXRBbmltYXRpb24iLCJ0aW1lciIsIndhdGNoIiwic2V0IiwiaW5pdCIsImNyZWF0ZWQiLCJkZXN0cm95ZWQiLCJjbGVhclRpbWVvdXQiLCJtZXRob2RzIiwiZ2V0UmVjdCIsInRoZW4iLCJyZWN0Iiwid3giLCJjcmVhdGVBbmltYXRpb24iLCJkdXJhdGlvbiIsInRpbWVpbmdGdW5jdGlvbiIsInNjcm9sbCIsInRyYW5zbGF0ZVgiLCJzdGVwIiwiYW5pbWF0aW9uRGF0YSIsImV4cG9ydCIsInNldFRpbWVvdXQiLCJvbkNsaWNrSWNvbiIsIm9uQ2xpY2siLCJldmVudCIsIiRlbWl0Il0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxhQUFULFFBQThCLHFCQUE5QjtBQUVBLE1BQU1DLFVBQVUsR0FBRyxTQUFuQjtBQUNBLE1BQU1DLFFBQVEsR0FBRyxTQUFqQjtBQUVBRixhQUFhLENBQUM7QUFDWkcsRUFBQUEsS0FBSyxFQUFFO0FBQ0xDLElBQUFBLElBQUksRUFBRTtBQUNKQyxNQUFBQSxJQUFJLEVBQUVDLE1BREY7QUFFSkMsTUFBQUEsS0FBSyxFQUFFO0FBRkgsS0FERDtBQUtMQyxJQUFBQSxJQUFJLEVBQUU7QUFDSkgsTUFBQUEsSUFBSSxFQUFFQyxNQURGO0FBRUpDLE1BQUFBLEtBQUssRUFBRTtBQUZILEtBTEQ7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QSxVQUFVLENBQUMsTUFBSztBQUNkLGFBQUtsQixHQUFMLENBQVM7QUFDUGdCLFVBQUFBLGFBQWEsRUFBRUEsYUFBYSxDQUFDQyxNQUFkO0FBRFIsU0FBVDtBQUdELE9BSlMsRUFJUCxHQUpPLENBQVY7QUFNQSxZQUFNbkIsS0FBSyxHQUFHb0IsVUFBVSxDQUFDLE1BQUs7QUFDNUIsYUFBS0wsTUFBTDtBQUNELE9BRnVCLEVBRXJCbEIsTUFGcUIsQ0FBeEI7QUFJQSxXQUFLSyxHQUFMLENBQVM7QUFDUEYsUUFBQUE7QUFETyxPQUFUO0FBR0QsS0FuRU07O0FBcUVQcUIsSUFBQUEsV0FBVyxHQUFBO0FBQ1QsWUFBTTtBQUFFckIsUUFBQUE7QUFBRixVQUFZLEtBQUtULElBQXZCO0FBQ0FTLE1BQUFBLEtBQUssSUFBSU0sWUFBWSxDQUFDTixLQUFELENBQXJCO0FBQ0EsV0FBS0UsR0FBTCxDQUFTO0FBQ1BWLFFBQUFBLElBQUksRUFBRSxLQURDO0FBRVBRLFFBQUFBLEtBQUssRUFBRTtBQUZBLE9BQVQ7QUFJRCxLQTVFTTs7QUE4RVBzQixJQUFBQSxPQUFPLENBQUNDLEtBQUQsRUFBbUI7QUFDeEIsV0FBS0MsS0FBTCxDQUFXLE9BQVgsRUFBb0JELEtBQXBCO0FBQ0Q7O0FBaEZNO0FBMUVHLENBQUQsQ0FBYiIsImZpbGUiOiJub3RpY2UtYmFyL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3B1aUNvbXBvbmVudCB9IGZyb20gJy4uL2NvbW1vbi9jb21wb25lbnQnO1xyXG5cclxuY29uc3QgRk9OVF9DT0xPUiA9ICcjZWQ2YTBjJztcclxuY29uc3QgQkdfQ09MT1IgPSAnI2ZmZmJlOCc7XHJcblxyXG5TcHVpQ29tcG9uZW50KHtcclxuICBwcm9wczoge1xyXG4gICAgdGV4dDoge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIHZhbHVlOiAnJ1xyXG4gICAgfSxcclxuICAgIG1vZGU6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICB2YWx1ZTogJydcclxuICAgIH0sXHJcbiAgICB1cmw6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICB2YWx1ZTogJydcclxuICAgIH0sXHJcbiAgICBvcGVuVHlwZToge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIHZhbHVlOiAnbmF2aWdhdGUnXHJcbiAgICB9LFxyXG4gICAgZGVsYXk6IHtcclxuICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICB2YWx1ZTogMFxyXG4gICAgfSxcclxuICAgIHNwZWVkOiB7XHJcbiAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgdmFsdWU6IDUwXHJcbiAgICB9LFxyXG4gICAgc2Nyb2xsYWJsZToge1xyXG4gICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICB2YWx1ZTogdHJ1ZVxyXG4gICAgfSxcclxuICAgIGxlZnRJY29uOiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgdmFsdWU6ICcnXHJcbiAgICB9LFxyXG4gICAgY29sb3I6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICB2YWx1ZTogRk9OVF9DT0xPUlxyXG4gICAgfSxcclxuICAgIGJhY2tncm91bmRDb2xvcjoge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIHZhbHVlOiBCR19DT0xPUlxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIGRhdGE6IHtcclxuICAgIHNob3c6IHRydWUsXHJcbiAgICBoYXNSaWdodEljb246IGZhbHNlLFxyXG4gICAgd2lkdGg6IHVuZGVmaW5lZCxcclxuICAgIHdyYXBXaWR0aDogdW5kZWZpbmVkLFxyXG4gICAgZWxhcHNlOiB1bmRlZmluZWQsXHJcbiAgICBhbmltYXRpb246IG51bGwsXHJcbiAgICByZXNldEFuaW1hdGlvbjogbnVsbCxcclxuICAgIHRpbWVyOiBudWxsXHJcbiAgfSxcclxuXHJcbiAgd2F0Y2g6IHtcclxuICAgIHRleHQoKSB7XHJcbiAgICAgIHRoaXMuc2V0KHt9LCB0aGlzLmluaXQpO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIGNyZWF0ZWQoKSB7XHJcbiAgICBpZiAodGhpcy5kYXRhLm1vZGUpIHtcclxuICAgICAgdGhpcy5zZXQoe1xyXG4gICAgICAgIGhhc1JpZ2h0SWNvbjogdHJ1ZVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBkZXN0cm95ZWQoKSB7XHJcbiAgICBjb25zdCB7IHRpbWVyIH0gPSB0aGlzLmRhdGE7XHJcbiAgICB0aW1lciAmJiBjbGVhclRpbWVvdXQodGltZXIpO1xyXG4gIH0sXHJcblxyXG4gIG1ldGhvZHM6IHtcclxuICAgIGluaXQoKSB7XHJcbiAgICAgIHRoaXMuZ2V0UmVjdCgnLnNwdWktbm90aWNlLWJhcl9fY29udGVudCcpLnRoZW4ocmVjdCA9PiB7XHJcbiAgICAgICAgaWYgKCFyZWN0IHx8ICFyZWN0LndpZHRoKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0KHtcclxuICAgICAgICAgIHdpZHRoOiByZWN0LndpZHRoXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0UmVjdCgnLnNwdWktbm90aWNlLWJhcl9fY29udGVudC13cmFwJykudGhlbihyZWN0ID0+IHtcclxuICAgICAgICAgIGlmICghcmVjdCB8fCAhcmVjdC53aWR0aCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgY29uc3Qgd3JhcFdpZHRoID0gcmVjdC53aWR0aDtcclxuICAgICAgICAgIGNvbnN0IHtcclxuICAgICAgICAgICAgd2lkdGgsIHNwZWVkLCBzY3JvbGxhYmxlLCBkZWxheVxyXG4gICAgICAgICAgfSA9IHRoaXMuZGF0YTtcclxuXHJcbiAgICAgICAgICBpZiAoc2Nyb2xsYWJsZSAmJiB3cmFwV2lkdGggPCB3aWR0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBlbGFwc2UgPSB3aWR0aCAvIHNwZWVkICogMTAwMDtcclxuICAgICAgICAgICAgY29uc3QgYW5pbWF0aW9uID0gd3guY3JlYXRlQW5pbWF0aW9uKHtcclxuICAgICAgICAgICAgICBkdXJhdGlvbjogZWxhcHNlLFxyXG4gICAgICAgICAgICAgIHRpbWVpbmdGdW5jdGlvbjogJ2xpbmVhcicsXHJcbiAgICAgICAgICAgICAgZGVsYXlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc2V0QW5pbWF0aW9uID0gd3guY3JlYXRlQW5pbWF0aW9uKHtcclxuICAgICAgICAgICAgICBkdXJhdGlvbjogMCxcclxuICAgICAgICAgICAgICB0aW1laW5nRnVuY3Rpb246ICdsaW5lYXInXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zZXQoe1xyXG4gICAgICAgICAgICAgIGVsYXBzZSxcclxuICAgICAgICAgICAgICB3cmFwV2lkdGgsXHJcbiAgICAgICAgICAgICAgYW5pbWF0aW9uLFxyXG4gICAgICAgICAgICAgIHJlc2V0QW5pbWF0aW9uXHJcbiAgICAgICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnNjcm9sbCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIHNjcm9sbCgpIHtcclxuICAgICAgY29uc3Qge1xyXG4gICAgICAgIGFuaW1hdGlvbiwgcmVzZXRBbmltYXRpb24sIHdyYXBXaWR0aCwgZWxhcHNlLCBzcGVlZFxyXG4gICAgICB9ID0gdGhpcy5kYXRhO1xyXG4gICAgICByZXNldEFuaW1hdGlvbi50cmFuc2xhdGVYKHdyYXBXaWR0aCkuc3RlcCgpO1xyXG4gICAgICBjb25zdCBhbmltYXRpb25EYXRhID0gYW5pbWF0aW9uLnRyYW5zbGF0ZVgoLShlbGFwc2UgKiBzcGVlZCkgLyAxMDAwKS5zdGVwKCk7XHJcbiAgICAgIHRoaXMuc2V0KHtcclxuICAgICAgICBhbmltYXRpb25EYXRhOiByZXNldEFuaW1hdGlvbi5leHBvcnQoKVxyXG4gICAgICB9KTtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5zZXQoe1xyXG4gICAgICAgICAgYW5pbWF0aW9uRGF0YTogYW5pbWF0aW9uRGF0YS5leHBvcnQoKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LCAxMDApO1xyXG5cclxuICAgICAgY29uc3QgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLnNjcm9sbCgpO1xyXG4gICAgICB9LCBlbGFwc2UpO1xyXG5cclxuICAgICAgdGhpcy5zZXQoe1xyXG4gICAgICAgIHRpbWVyXHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkNsaWNrSWNvbigpIHtcclxuICAgICAgY29uc3QgeyB0aW1lciB9ID0gdGhpcy5kYXRhO1xyXG4gICAgICB0aW1lciAmJiBjbGVhclRpbWVvdXQodGltZXIpO1xyXG4gICAgICB0aGlzLnNldCh7XHJcbiAgICAgICAgc2hvdzogZmFsc2UsXHJcbiAgICAgICAgdGltZXI6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ2xpY2soZXZlbnQ6IFdlYXBwLkV2ZW50KSB7XHJcbiAgICAgIHRoaXMuJGVtaXQoJ2NsaWNrJywgZXZlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxufSk7XHJcbiJdfQ==
