import { SpuiComponent } from '../common/component';
import { isDef } from '../common/utils';
const currentYear = new Date().getFullYear();

const isValidDate = date => isDef(date) && !isNaN(new Date(date).getTime());

function range(num, min, max) {
  return Math.min(Math.max(num, min), max);
}

SpuiComponent({
  props: {
    value: null,
    title: String,
    loading: Boolean,
    itemHeight: {
      type: Number,
      value: 44
    },
    visibleItemCount: {
      type: Number,
      value: 5
    },
    confirmButtonText: {
      type: String,
      value: '确认'
    },
    cancelButtonText: {
      type: String,
      value: '取消'
    },
    type: {
      type: String,
      value: 'datetime'
    },
    showToolbar: {
      type: Boolean,
      value: true
    },
    minDate: {
      type: Number,
      value: new Date(currentYear - 10, 0, 1).getTime()
    },
    maxDate: {
      type: Number,
      value: new Date(currentYear + 10, 11, 31).getTime()
    },
    minHour: {
      type: Number,
      value: 0
    },
    maxHour: {
      type: Number,
      value: 23
    },
    minMinute: {
      type: Number,
      value: 0
    },
    maxMinute: {
      type: Number,
      value: 59
    }
  },
  data: {
    pickerValue: [],
    innerValue: Date.now()
  },
  computed: {
    columns() {
      const results = this.getRanges().map(({
        type,
        range
      }) => {
        const values = this.times(range[1] - range[0] + 1, index => {
          let value = range[0] + index;
          value = type === 'year' ? `${value}` : this.pad(value);
          return value;
        });
        return values;
      });
      return results;
    }

  },
  watch: {
    value(val) {
      const {
        data
      } = this;
      val = this.correctValue(val);
      const isEqual = val === data.innerValue;

      if (!isEqual) {
        this.set({
          innerValue: val
        }, () => {
          this.updateColumnValue(val);
          this.$emit('input', val);
        });
      }
    }

  },
  methods: {
    getRanges() {
      const {
        data
      } = this;

      if (data.type === 'time') {
        return [{
          type: 'hour',
          range: [data.minHour, data.maxHour]
        }, {
          type: 'minute',
          range: [data.minMinute, data.maxMinute]
        }];
      }

      const {
        maxYear,
        maxDate,
        maxMonth,
        maxHour,
        maxMinute
      } = this.getBoundary('max', data.innerValue);
      const {
        minYear,
        minDate,
        minMonth,
        minHour,
        minMinute
      } = this.getBoundary('min', data.innerValue);
      const result = [{
        type: 'year',
        range: [minYear, maxYear]
      }, {
        type: 'month',
        range: [minMonth, maxMonth]
      }, {
        type: 'day',
        range: [minDate, maxDate]
      }, {
        type: 'hour',
        range: [minHour, maxHour]
      }, {
        type: 'minute',
        range: [minMinute, maxMinute]
      }];
      if (data.type === 'date') result.splice(3, 2);
      if (data.type === 'year-month') result.splice(2, 3);
      return result;
    },

    pad(val) {
      return `00${val}`.slice(-2);
    },

    correctValue(value) {
      const {
        data,
        pad
      } = this; // validate value

      const isDateType = data.type !== 'time';

      if (isDateType && !isValidDate(value)) {
        value = data.minDate;
      } else if (!isDateType && !value) {
        const {
          minHour
        } = data;
        value = `${pad(minHour)}:00`;
      } // time type


      if (!isDateType) {
        let [hour, minute] = value.split(':');
        hour = pad(range(hour, data.minHour, data.maxHour));
        minute = pad(range(minute, data.minMinute, data.maxMinute));
        return `${hour}:${minute}`;
      } // date type


      value = Math.max(value, data.minDate);
      value = Math.min(value, data.maxDate);
      return value;
    },

    times(n, iteratee) {
      let index = -1;
      const result = Array(n);

      while (++index < n) {
        result[index] = iteratee(index);
      }

      return result;
    },

    getBoundary(type, innerValue) {
      const value = new Date(innerValue);
      const boundary = new Date(this.data[`${type}Date`]);
      const year = boundary.getFullYear();
      let month = 1;
      let date = 1;
      let hour = 0;
      let minute = 0;

      if (type === 'max') {
        month = 12;
        date = this.getMonthEndDay(value.getFullYear(), value.getMonth() + 1);
        hour = 23;
        minute = 59;
      }

      if (value.getFullYear() === year) {
        month = boundary.getMonth() + 1;

        if (value.getMonth() + 1 === month) {
          date = boundary.getDate();

          if (value.getDate() === date) {
            hour = boundary.getHours();

            if (value.getHours() === hour) {
              minute = boundary.getMinutes();
            }
          }
        }
      }

      return {
        [`${type}Year`]: year,
        [`${type}Month`]: month,
        [`${type}Date`]: date,
        [`${type}Hour`]: hour,
        [`${type}Minute`]: minute
      };
    },

    getTrueValue(formattedValue) {
      if (!formattedValue) return;

      while (isNaN(parseInt(formattedValue, 10))) {
        formattedValue = formattedValue.slice(1);
      }

      return parseInt(formattedValue, 10);
    },

    getMonthEndDay(year, month) {
      return 32 - new Date(year, month - 1, 32).getDate();
    },

    onCancel() {
      this.$emit('cancel');
    },

    onConfirm() {
      this.$emit('confirm', this.data.innerValue);
    },

    onChange(event) {
      const {
        data
      } = this;
      const pickerValue = event.detail.value;
      const values = pickerValue.slice(0, data.columns.length).map((value, index) => data.columns[index][value]);
      let value;

      if (data.type === 'time') {
        value = values.join(':');
      } else {
        const year = this.getTrueValue(values[0]);
        const month = this.getTrueValue(values[1]);
        const maxDate = this.getMonthEndDay(year, month);
        let date = this.getTrueValue(values[2]);

        if (data.type === 'year-month') {
          date = 1;
        }

        date = date > maxDate ? maxDate : date;
        let hour = 0;
        let minute = 0;

        if (data.type === 'datetime') {
          hour = this.getTrueValue(values[3]);
          minute = this.getTrueValue(values[4]);
        }

        value = new Date(year, month - 1, date, hour, minute);
      }

      value = this.correctValue(value);
      this.set({
        innerValue: value
      }, () => {
        this.updateColumnValue(value);
        this.$emit('input', value);
        this.$emit('change', this);
      });
    },

    getColumnValue(index) {
      return this.getValues()[index];
    },

    setColumnValue(index, value) {
      const {
        pickerValue,
        columns
      } = this.data;
      pickerValue[index] = columns[index].indexOf(value);
      this.set({
        pickerValue
      });
    },

    getColumnValues(index) {
      return this.data.columns[index];
    },

    setColumnValues(index, values) {
      const {
        columns
      } = this.data;
      columns[index] = values;
      this.set({
        columns
      });
    },

    getValues() {
      const {
        pickerValue,
        columns
      } = this.data;
      return pickerValue.map((value, index) => columns[index][value]);
    },

    setValues(values) {
      const {
        columns
      } = this.data;
      this.set({
        pickerValue: values.map((value, index) => columns[index].indexOf(value))
      });
    },

    updateColumnValue(value) {
      let values = [];
      const {
        pad,
        data
      } = this;
      const {
        columns
      } = data;

      if (data.type === 'time') {
        const currentValue = value.split(':');
        values = [columns[0].indexOf(currentValue[0]), columns[1].indexOf(currentValue[1])];
      } else {
        const date = new Date(value);
        values = [columns[0].indexOf(`${date.getFullYear()}`), columns[1].indexOf(pad(date.getMonth() + 1))];

        if (data.type === 'date') {
          values.push(columns[2].indexOf(pad(date.getDate())));
        }

        if (data.type === 'datetime') {
          values.push(columns[2].indexOf(pad(date.getDate())), columns[3].indexOf(pad(date.getHours())), columns[4].indexOf(pad(date.getMinutes())));
        }
      }

      this.set({
        pickerValue: values
      });
    }

  },

  created() {
    const innerValue = this.correctValue(this.data.value);
    this.set({
      innerValue
    }, () => {
      this.updateColumnValue(innerValue);
      this.$emit('input', innerValue);
    });
  }

});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGV0aW1lLXBpY2tlci9pbmRleC50cyJdLCJuYW1lcyI6WyJTcHVpQ29tcG9uZW50IiwiaXNEZWYiLCJjdXJyZW50WWVhciIsIkRhdGUiLCJnZXRGdWxsWWVhciIsImlzVmFsaWREYXRlIiwiZGF0ZSIsImlzTmFOIiwiZ2V0VGltZSIsInJhbmdlIiwibnVtIiwibWluIiwibWF4IiwiTWF0aCIsInByb3BzIiwidmFsdWUiLCJ0aXRsZSIsIlN0cmluZyIsImxvYWRpbmciLCJCb29sZWFuIiwiaXRlbUhlaWdodCIsInR5cGUiLCJOdW1iZXIiLCJ2aXNpYmxlSXRlbUNvdW50IiwiY29uZmlybUJ1dHRvblRleHQiLCJjYW5jZWxCdXR0b25UZXh0Iiwic2hvd1Rvb2xiYXIiLCJtaW5EYXRlIiwibWF4RGF0ZSIsIm1pbkhvdXIiLCJtYXhIb3VyIiwibWluTWludXRlIiwibWF4TWludXRlIiwiZGF0YSIsInBpY2tlclZhbHVlIiwiaW5uZXJWYWx1ZSIsIm5vdyIsImNvbXB1dGVkIiwiY29sdW1ucyIsInJlc3VsdHMiLCJnZXRSYW5nZXMiLCJtYXAiLCJ2YWx1ZXMiLCJ0aW1lcyIsImluZGV4IiwicGFkIiwid2F0Y2giLCJ2YWwiLCJjb3JyZWN0VmFsdWUiLCJpc0VxdWFsIiwic2V0IiwidXBkYXRlQ29sdW1uVmFsdWUiLCIkZW1pdCIsIm1ldGhvZHMiLCJtYXhZZWFyIiwibWF4TW9udGgiLCJnZXRCb3VuZGFyeSIsIm1pblllYXIiLCJtaW5Nb250aCIsInJlc3VsdCIsInNwbGljZSIsInNsaWNlIiwiaXNEYXRlVHlwZSIsImhvdXIiLCJtaW51dGUiLCJzcGxpdCIsIm4iLCJpdGVyYXRlZSIsIkFycmF5IiwiYm91bmRhcnkiLCJ5ZWFyIiwibW9udGgiLCJnZXRNb250aEVuZERheSIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsImdldEhvdXJzIiwiZ2V0TWludXRlcyIsImdldFRydWVWYWx1ZSIsImZvcm1hdHRlZFZhbHVlIiwicGFyc2VJbnQiLCJvbkNhbmNlbCIsIm9uQ29uZmlybSIsIm9uQ2hhbmdlIiwiZXZlbnQiLCJkZXRhaWwiLCJsZW5ndGgiLCJqb2luIiwiZ2V0Q29sdW1uVmFsdWUiLCJnZXRWYWx1ZXMiLCJzZXRDb2x1bW5WYWx1ZSIsImluZGV4T2YiLCJnZXRDb2x1bW5WYWx1ZXMiLCJzZXRDb2x1bW5WYWx1ZXMiLCJzZXRWYWx1ZXMiLCJjdXJyZW50VmFsdWUiLCJwdXNoIiwiY3JlYXRlZCJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBU0EsYUFBVCxRQUE4QixxQkFBOUI7QUFDQSxTQUFTQyxLQUFULFFBQXNCLGlCQUF0QjtBQUVBLE1BQU1DLFdBQVcsR0FBRyxJQUFJQyxJQUFKLEdBQVdDLFdBQVgsRUFBcEI7O0FBQ0EsTUFBTUMsV0FBVyxHQUFHQyxJQUFJLElBQUlMLEtBQUssQ0FBQ0ssSUFBRCxDQUFMLElBQWUsQ0FBQ0MsS0FBSyxDQUFDLElBQUlKLElBQUosQ0FBU0csSUFBVCxFQUFlRSxPQUFmLEVBQUQsQ0FBakQ7O0FBRUEsU0FBU0MsS0FBVCxDQUFlQyxHQUFmLEVBQW9CQyxHQUFwQixFQUF5QkMsR0FBekIsRUFBNEI7QUFDMUIsU0FBT0MsSUFBSSxDQUFDRixHQUFMLENBQVNFLElBQUksQ0FBQ0QsR0FBTCxDQUFTRixHQUFULEVBQWNDLEdBQWQsQ0FBVCxFQUE2QkMsR0FBN0IsQ0FBUDtBQUNEOztBQUVEWixhQUFhLENBQUM7QUFDWmMsRUFBQUEsS0FBSyxFQUFFO0FBQ0xDLElBQUFBLEtBQUssRUFBRSxJQURGO0FBRUxDLElBQUFBLEtBQUssRUFBRUMsTUFGRjtBQUdMQyxJQUFBQSxPQUFPLEVBQUVDLE9BSEo7QUFJTEMsSUFBQUEsVUFBVSxFQUFFO0FBQ1ZDLE1BQUFBLElBQUksRUFBRUMsTUFESTtBQUVWUCxNQUFBQSxLQUFLLEVBQUU7QUFGRyxLQUpQO0FBUUxRLElBQUFBLGdCQUFnQixFQUFFO0FBQ2hCRixNQUFBQSxJQUFJLEVBQUVDLE1BRFU7QUFFaEJQLE1BQUFBLEtBQUssRUFBRTtBQUZTLEtBUmI7QUFZTFMsSUFBQUEsaUJBQWlCLEVBQUU7QUFDakJILE1BQUFBLElBQUksRUFBRUosTUFEVztBQUVqQkYsTUFBQUEsS0FBSyxFQUFFO0FBRlUsS0FaZDtBQWdCTFUsSUFBQUEsZ0JBQWdCLEVBQUU7QUFDaEJKLE1BQUFBLElBQUksRUFBRUosTUFEVTtBQUVoQkYsTUFBQUEsS0FBSyxFQUFFO0FBRlMsS0FoQmI7QUFvQkxNLElBQUFBLElBQUksRUFBRTtBQUNKQSxNQUFBQSxJQUFJLEVBQUVKLE1BREY7QUFFSkYsTUFBQUEsS0FBSyxFQUFFO0FBRkgsS0FwQkQ7QUF3QkxXLElBQUFBLFdBQVcsRUFBRTtBQUNYTCxNQUFBQSxJQUFJLEVBQUVGLE9BREs7QUFFWEosTUFBQUEsS0FBSyxFQUFFO0FBRkksS0F4QlI7QUE0QkxZLElBQUFBLE9BQU8sRUFBRTtBQUNQTixNQUFBQSxJQUFJLEVBQUVDLE1BREM7QUFFUFAsTUFBQUEsS0FBSyxFQUFFLElBQUlaLElBQUosQ0FBU0QsV0FBVyxHQUFHLEVBQXZCLEVBQTJCLENBQTNCLEVBQThCLENBQTlCLEVBQWlDTSxPQUFqQztBQUZBLEtBNUJKO0FBZ0NMb0IsSUFBQUEsT0FBTyxFQUFFO0FBQ1BQLE1BQUFBLElBQUksRUFBRUMsTUFEQztBQUVQUCxNQUFBQSxLQUFLLEVBQUUsSUFBSVosSUFBSixDQUFTRCxXQUFXLEdBQUcsRUFBdkIsRUFBMkIsRUFBM0IsRUFBK0IsRUFBL0IsRUFBbUNNLE9BQW5DO0FBRkEsS0FoQ0o7QUFvQ0xxQixJQUFBQSxPQUFPLEVBQUU7QUFDUFIsTUFBQUEsSUFBSSxFQUFFQyxNQURDO0FBRVBQLE1BQUFBLEtBQUssRUFBRTtBQUZBLEtBcENKO0FBd0NMZSxJQUFBQSxPQUFPLEVBQUU7QUFDUFQsTUFBQUEsSUFBSSxFQUFFQyxNQURDO0FBRVBQLE1BQUFBLEtBQUssRUFBRTtBQUZBLEtBeENKO0FBNENMZ0IsSUFBQUEsU0FBUyxFQUFFO0FBQ1RWLE1BQUFBLElBQUksRUFBRUMsTUFERztBQUVUUCxNQUFBQSxLQUFLLEVBQUU7QUFGRSxLQTVDTjtBQWdETGlCLElBQUFBLFNBQVMsRUFBRTtBQUNUWCxNQUFBQSxJQUFJLEVBQUVDLE1BREc7QUFFVFAsTUFBQUEsS0FBSyxFQUFFO0FBRkU7QUFoRE4sR0FESztBQXVEWmtCLEVBQUFBLElBQUksRUFBRTtBQUNKQyxJQUFBQSxXQUFXLEVBQUUsRUFEVDtBQUVKQyxJQUFBQSxVQUFVLEVBQUVoQyxJQUFJLENBQUNpQyxHQUFMO0FBRlIsR0F2RE07QUE0RFpDLEVBQUFBLFFBQVEsRUFBRTtBQUNSQyxJQUFBQSxPQUFPLEdBQUE7QUFDTCxZQUFNQyxPQUFPLEdBQUcsS0FBS0MsU0FBTCxHQUFpQkMsR0FBakIsQ0FBcUIsQ0FBQztBQUFFcEIsUUFBQUEsSUFBRjtBQUFRWixRQUFBQTtBQUFSLE9BQUQsS0FBb0I7QUFDdkQsY0FBTWlDLE1BQU0sR0FBRyxLQUFLQyxLQUFMLENBQVdsQyxLQUFLLENBQUMsQ0FBRCxDQUFMLEdBQVdBLEtBQUssQ0FBQyxDQUFELENBQWhCLEdBQXNCLENBQWpDLEVBQW9DbUMsS0FBSyxJQUFHO0FBQ3pELGNBQUk3QixLQUFLLEdBQUdOLEtBQUssQ0FBQyxDQUFELENBQUwsR0FBV21DLEtBQXZCO0FBQ0E3QixVQUFBQSxLQUFLLEdBQUdNLElBQUksS0FBSyxNQUFULEdBQWtCLEdBQUdOLEtBQUssRUFBMUIsR0FBK0IsS0FBSzhCLEdBQUwsQ0FBUzlCLEtBQVQsQ0FBdkM7QUFDQSxpQkFBT0EsS0FBUDtBQUNELFNBSmMsQ0FBZjtBQU1BLGVBQU8yQixNQUFQO0FBQ0QsT0FSZSxDQUFoQjtBQVVBLGFBQU9ILE9BQVA7QUFDRDs7QUFiTyxHQTVERTtBQTRFWk8sRUFBQUEsS0FBSyxFQUFFO0FBQ0wvQixJQUFBQSxLQUFLLENBQUNnQyxHQUFELEVBQUk7QUFDUCxZQUFNO0FBQUVkLFFBQUFBO0FBQUYsVUFBVyxJQUFqQjtBQUNBYyxNQUFBQSxHQUFHLEdBQUcsS0FBS0MsWUFBTCxDQUFrQkQsR0FBbEIsQ0FBTjtBQUNBLFlBQU1FLE9BQU8sR0FBR0YsR0FBRyxLQUFLZCxJQUFJLENBQUNFLFVBQTdCOztBQUNBLFVBQUksQ0FBQ2MsT0FBTCxFQUFjO0FBQ1osYUFBS0MsR0FBTCxDQUFTO0FBQUVmLFVBQUFBLFVBQVUsRUFBRVk7QUFBZCxTQUFULEVBQThCLE1BQUs7QUFDakMsZUFBS0ksaUJBQUwsQ0FBdUJKLEdBQXZCO0FBQ0EsZUFBS0ssS0FBTCxDQUFXLE9BQVgsRUFBb0JMLEdBQXBCO0FBQ0QsU0FIRDtBQUlEO0FBQ0Y7O0FBWEksR0E1RUs7QUEwRlpNLEVBQUFBLE9BQU8sRUFBRTtBQUNQYixJQUFBQSxTQUFTLEdBQUE7QUFDUCxZQUFNO0FBQUVQLFFBQUFBO0FBQUYsVUFBVyxJQUFqQjs7QUFDQSxVQUFJQSxJQUFJLENBQUNaLElBQUwsS0FBYyxNQUFsQixFQUEwQjtBQUN4QixlQUFPLENBQ0w7QUFDRUEsVUFBQUEsSUFBSSxFQUFFLE1BRFI7QUFFRVosVUFBQUEsS0FBSyxFQUFFLENBQUN3QixJQUFJLENBQUNKLE9BQU4sRUFBZUksSUFBSSxDQUFDSCxPQUFwQjtBQUZULFNBREssRUFLTDtBQUNFVCxVQUFBQSxJQUFJLEVBQUUsUUFEUjtBQUVFWixVQUFBQSxLQUFLLEVBQUUsQ0FBQ3dCLElBQUksQ0FBQ0YsU0FBTixFQUFpQkUsSUFBSSxDQUFDRCxTQUF0QjtBQUZULFNBTEssQ0FBUDtBQVVEOztBQUVELFlBQU07QUFBRXNCLFFBQUFBLE9BQUY7QUFBVzFCLFFBQUFBLE9BQVg7QUFBb0IyQixRQUFBQSxRQUFwQjtBQUE4QnpCLFFBQUFBLE9BQTlCO0FBQXVDRSxRQUFBQTtBQUF2QyxVQUFxRCxLQUFLd0IsV0FBTCxDQUFpQixLQUFqQixFQUF3QnZCLElBQUksQ0FBQ0UsVUFBN0IsQ0FBM0Q7QUFDQSxZQUFNO0FBQUVzQixRQUFBQSxPQUFGO0FBQVc5QixRQUFBQSxPQUFYO0FBQW9CK0IsUUFBQUEsUUFBcEI7QUFBOEI3QixRQUFBQSxPQUE5QjtBQUF1Q0UsUUFBQUE7QUFBdkMsVUFBcUQsS0FBS3lCLFdBQUwsQ0FBaUIsS0FBakIsRUFBd0J2QixJQUFJLENBQUNFLFVBQTdCLENBQTNEO0FBRUEsWUFBTXdCLE1BQU0sR0FBRyxDQUNiO0FBQ0V0QyxRQUFBQSxJQUFJLEVBQUUsTUFEUjtBQUVFWixRQUFBQSxLQUFLLEVBQUUsQ0FBQ2dELE9BQUQsRUFBVUgsT0FBVjtBQUZULE9BRGEsRUFLYjtBQUNFakMsUUFBQUEsSUFBSSxFQUFFLE9BRFI7QUFFRVosUUFBQUEsS0FBSyxFQUFFLENBQUNpRCxRQUFELEVBQVdILFFBQVg7QUFGVCxPQUxhLEVBU2I7QUFDRWxDLFFBQUFBLElBQUksRUFBRSxLQURSO0FBRUVaLFFBQUFBLEtBQUssRUFBRSxDQUFDa0IsT0FBRCxFQUFVQyxPQUFWO0FBRlQsT0FUYSxFQWFiO0FBQ0VQLFFBQUFBLElBQUksRUFBRSxNQURSO0FBRUVaLFFBQUFBLEtBQUssRUFBRSxDQUFDb0IsT0FBRCxFQUFVQyxPQUFWO0FBRlQsT0FiYSxFQWlCYjtBQUNFVCxRQUFBQSxJQUFJLEVBQUUsUUFEUjtBQUVFWixRQUFBQSxLQUFLLEVBQUUsQ0FBQ3NCLFNBQUQsRUFBWUMsU0FBWjtBQUZULE9BakJhLENBQWY7QUF1QkEsVUFBSUMsSUFBSSxDQUFDWixJQUFMLEtBQWMsTUFBbEIsRUFBMEJzQyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxDQUFkLEVBQWlCLENBQWpCO0FBQzFCLFVBQUkzQixJQUFJLENBQUNaLElBQUwsS0FBYyxZQUFsQixFQUFnQ3NDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLENBQWQsRUFBaUIsQ0FBakI7QUFDaEMsYUFBT0QsTUFBUDtBQUNELEtBN0NNOztBQStDUGQsSUFBQUEsR0FBRyxDQUFDRSxHQUFELEVBQXFCO0FBQ3RCLGFBQU8sS0FBS0EsR0FBRyxFQUFSLENBQVdjLEtBQVgsQ0FBaUIsQ0FBQyxDQUFsQixDQUFQO0FBQ0QsS0FqRE07O0FBbURQYixJQUFBQSxZQUFZLENBQUNqQyxLQUFELEVBQU07QUFDaEIsWUFBTTtBQUFFa0IsUUFBQUEsSUFBRjtBQUFRWSxRQUFBQTtBQUFSLFVBQWdCLElBQXRCLENBRGdCLENBRWhCOztBQUNBLFlBQU1pQixVQUFVLEdBQUc3QixJQUFJLENBQUNaLElBQUwsS0FBYyxNQUFqQzs7QUFDQSxVQUFJeUMsVUFBVSxJQUFJLENBQUN6RCxXQUFXLENBQUNVLEtBQUQsQ0FBOUIsRUFBdUM7QUFDckNBLFFBQUFBLEtBQUssR0FBR2tCLElBQUksQ0FBQ04sT0FBYjtBQUNELE9BRkQsTUFFTyxJQUFJLENBQUNtQyxVQUFELElBQWUsQ0FBQy9DLEtBQXBCLEVBQTJCO0FBQ2hDLGNBQU07QUFBRWMsVUFBQUE7QUFBRixZQUFjSSxJQUFwQjtBQUNBbEIsUUFBQUEsS0FBSyxHQUFHLEdBQUc4QixHQUFHLENBQUNoQixPQUFELENBQVMsS0FBdkI7QUFDRCxPQVRlLENBV2hCOzs7QUFDQSxVQUFJLENBQUNpQyxVQUFMLEVBQWlCO0FBQ2YsWUFBSSxDQUFDQyxJQUFELEVBQU9DLE1BQVAsSUFBaUJqRCxLQUFLLENBQUNrRCxLQUFOLENBQVksR0FBWixDQUFyQjtBQUNBRixRQUFBQSxJQUFJLEdBQUdsQixHQUFHLENBQUNwQyxLQUFLLENBQUNzRCxJQUFELEVBQU85QixJQUFJLENBQUNKLE9BQVosRUFBcUJJLElBQUksQ0FBQ0gsT0FBMUIsQ0FBTixDQUFWO0FBQ0FrQyxRQUFBQSxNQUFNLEdBQUduQixHQUFHLENBQUNwQyxLQUFLLENBQUN1RCxNQUFELEVBQVMvQixJQUFJLENBQUNGLFNBQWQsRUFBeUJFLElBQUksQ0FBQ0QsU0FBOUIsQ0FBTixDQUFaO0FBRUEsZUFBTyxHQUFHK0IsSUFBSSxJQUFJQyxNQUFNLEVBQXhCO0FBQ0QsT0FsQmUsQ0FvQmhCOzs7QUFDQWpELE1BQUFBLEtBQUssR0FBR0YsSUFBSSxDQUFDRCxHQUFMLENBQVNHLEtBQVQsRUFBZ0JrQixJQUFJLENBQUNOLE9BQXJCLENBQVI7QUFDQVosTUFBQUEsS0FBSyxHQUFHRixJQUFJLENBQUNGLEdBQUwsQ0FBU0ksS0FBVCxFQUFnQmtCLElBQUksQ0FBQ0wsT0FBckIsQ0FBUjtBQUVBLGFBQU9iLEtBQVA7QUFDRCxLQTVFTTs7QUE4RVA0QixJQUFBQSxLQUFLLENBQUN1QixDQUFELEVBQVlDLFFBQVosRUFBd0M7QUFDM0MsVUFBSXZCLEtBQUssR0FBRyxDQUFDLENBQWI7QUFDQSxZQUFNZSxNQUFNLEdBQUdTLEtBQUssQ0FBQ0YsQ0FBRCxDQUFwQjs7QUFFQSxhQUFPLEVBQUV0QixLQUFGLEdBQVVzQixDQUFqQixFQUFvQjtBQUNsQlAsUUFBQUEsTUFBTSxDQUFDZixLQUFELENBQU4sR0FBZ0J1QixRQUFRLENBQUN2QixLQUFELENBQXhCO0FBQ0Q7O0FBQ0QsYUFBT2UsTUFBUDtBQUNELEtBdEZNOztBQXdGUEgsSUFBQUEsV0FBVyxDQUFDbkMsSUFBRCxFQUFlYyxVQUFmLEVBQWlDO0FBQzFDLFlBQU1wQixLQUFLLEdBQUcsSUFBSVosSUFBSixDQUFTZ0MsVUFBVCxDQUFkO0FBQ0EsWUFBTWtDLFFBQVEsR0FBRyxJQUFJbEUsSUFBSixDQUFTLEtBQUs4QixJQUFMLENBQVUsR0FBR1osSUFBSSxNQUFqQixDQUFULENBQWpCO0FBQ0EsWUFBTWlELElBQUksR0FBR0QsUUFBUSxDQUFDakUsV0FBVCxFQUFiO0FBQ0EsVUFBSW1FLEtBQUssR0FBRyxDQUFaO0FBQ0EsVUFBSWpFLElBQUksR0FBRyxDQUFYO0FBQ0EsVUFBSXlELElBQUksR0FBRyxDQUFYO0FBQ0EsVUFBSUMsTUFBTSxHQUFHLENBQWI7O0FBRUEsVUFBSTNDLElBQUksS0FBSyxLQUFiLEVBQW9CO0FBQ2xCa0QsUUFBQUEsS0FBSyxHQUFHLEVBQVI7QUFDQWpFLFFBQUFBLElBQUksR0FBRyxLQUFLa0UsY0FBTCxDQUFvQnpELEtBQUssQ0FBQ1gsV0FBTixFQUFwQixFQUF5Q1csS0FBSyxDQUFDMEQsUUFBTixLQUFtQixDQUE1RCxDQUFQO0FBQ0FWLFFBQUFBLElBQUksR0FBRyxFQUFQO0FBQ0FDLFFBQUFBLE1BQU0sR0FBRyxFQUFUO0FBQ0Q7O0FBRUQsVUFBSWpELEtBQUssQ0FBQ1gsV0FBTixPQUF3QmtFLElBQTVCLEVBQWtDO0FBQ2hDQyxRQUFBQSxLQUFLLEdBQUdGLFFBQVEsQ0FBQ0ksUUFBVCxLQUFzQixDQUE5Qjs7QUFDQSxZQUFJMUQsS0FBSyxDQUFDMEQsUUFBTixLQUFtQixDQUFuQixLQUF5QkYsS0FBN0IsRUFBb0M7QUFDbENqRSxVQUFBQSxJQUFJLEdBQUcrRCxRQUFRLENBQUNLLE9BQVQsRUFBUDs7QUFDQSxjQUFJM0QsS0FBSyxDQUFDMkQsT0FBTixPQUFvQnBFLElBQXhCLEVBQThCO0FBQzVCeUQsWUFBQUEsSUFBSSxHQUFHTSxRQUFRLENBQUNNLFFBQVQsRUFBUDs7QUFDQSxnQkFBSTVELEtBQUssQ0FBQzRELFFBQU4sT0FBcUJaLElBQXpCLEVBQStCO0FBQzdCQyxjQUFBQSxNQUFNLEdBQUdLLFFBQVEsQ0FBQ08sVUFBVCxFQUFUO0FBQ0Q7QUFDRjtBQUNGO0FBQ0Y7O0FBRUQsYUFBTztBQUNMLFNBQUMsR0FBR3ZELElBQUksTUFBUixHQUFpQmlELElBRFo7QUFFTCxTQUFDLEdBQUdqRCxJQUFJLE9BQVIsR0FBa0JrRCxLQUZiO0FBR0wsU0FBQyxHQUFHbEQsSUFBSSxNQUFSLEdBQWlCZixJQUhaO0FBSUwsU0FBQyxHQUFHZSxJQUFJLE1BQVIsR0FBaUIwQyxJQUpaO0FBS0wsU0FBQyxHQUFHMUMsSUFBSSxRQUFSLEdBQW1CMkM7QUFMZCxPQUFQO0FBT0QsS0E1SE07O0FBOEhQYSxJQUFBQSxZQUFZLENBQUNDLGNBQUQsRUFBdUI7QUFDakMsVUFBSSxDQUFDQSxjQUFMLEVBQXFCOztBQUNyQixhQUFPdkUsS0FBSyxDQUFDd0UsUUFBUSxDQUFDRCxjQUFELEVBQWlCLEVBQWpCLENBQVQsQ0FBWixFQUE0QztBQUMxQ0EsUUFBQUEsY0FBYyxHQUFHQSxjQUFjLENBQUNqQixLQUFmLENBQXFCLENBQXJCLENBQWpCO0FBQ0Q7O0FBQ0QsYUFBT2tCLFFBQVEsQ0FBQ0QsY0FBRCxFQUFpQixFQUFqQixDQUFmO0FBQ0QsS0FwSU07O0FBc0lQTixJQUFBQSxjQUFjLENBQUNGLElBQUQsRUFBT0MsS0FBUCxFQUFZO0FBQ3hCLGFBQU8sS0FBSyxJQUFJcEUsSUFBSixDQUFTbUUsSUFBVCxFQUFlQyxLQUFLLEdBQUcsQ0FBdkIsRUFBMEIsRUFBMUIsRUFBOEJHLE9BQTlCLEVBQVo7QUFDRCxLQXhJTTs7QUEwSVBNLElBQUFBLFFBQVEsR0FBQTtBQUNOLFdBQUs1QixLQUFMLENBQVcsUUFBWDtBQUNELEtBNUlNOztBQThJUDZCLElBQUFBLFNBQVMsR0FBQTtBQUNQLFdBQUs3QixLQUFMLENBQVcsU0FBWCxFQUFzQixLQUFLbkIsSUFBTCxDQUFVRSxVQUFoQztBQUNELEtBaEpNOztBQWtKUCtDLElBQUFBLFFBQVEsQ0FBQ0MsS0FBRCxFQUFtQjtBQUN6QixZQUFNO0FBQUVsRCxRQUFBQTtBQUFGLFVBQVcsSUFBakI7QUFDQSxZQUFNQyxXQUFXLEdBQUdpRCxLQUFLLENBQUNDLE1BQU4sQ0FBYXJFLEtBQWpDO0FBQ0EsWUFBTTJCLE1BQU0sR0FBR1IsV0FBVyxDQUN2QjJCLEtBRFksQ0FDTixDQURNLEVBQ0g1QixJQUFJLENBQUNLLE9BQUwsQ0FBYStDLE1BRFYsRUFFWjVDLEdBRlksQ0FFUixDQUFDMUIsS0FBRCxFQUFRNkIsS0FBUixLQUFrQlgsSUFBSSxDQUFDSyxPQUFMLENBQWFNLEtBQWIsRUFBb0I3QixLQUFwQixDQUZWLENBQWY7QUFHQSxVQUFJQSxLQUFKOztBQUVBLFVBQUlrQixJQUFJLENBQUNaLElBQUwsS0FBYyxNQUFsQixFQUEwQjtBQUN4Qk4sUUFBQUEsS0FBSyxHQUFHMkIsTUFBTSxDQUFDNEMsSUFBUCxDQUFZLEdBQVosQ0FBUjtBQUNELE9BRkQsTUFFTztBQUNMLGNBQU1oQixJQUFJLEdBQUcsS0FBS08sWUFBTCxDQUFrQm5DLE1BQU0sQ0FBQyxDQUFELENBQXhCLENBQWI7QUFDQSxjQUFNNkIsS0FBSyxHQUFHLEtBQUtNLFlBQUwsQ0FBa0JuQyxNQUFNLENBQUMsQ0FBRCxDQUF4QixDQUFkO0FBQ0EsY0FBTWQsT0FBTyxHQUFHLEtBQUs0QyxjQUFMLENBQW9CRixJQUFwQixFQUEwQkMsS0FBMUIsQ0FBaEI7QUFDQSxZQUFJakUsSUFBSSxHQUFHLEtBQUt1RSxZQUFMLENBQWtCbkMsTUFBTSxDQUFDLENBQUQsQ0FBeEIsQ0FBWDs7QUFDQSxZQUFJVCxJQUFJLENBQUNaLElBQUwsS0FBYyxZQUFsQixFQUFnQztBQUM5QmYsVUFBQUEsSUFBSSxHQUFHLENBQVA7QUFDRDs7QUFDREEsUUFBQUEsSUFBSSxHQUFHQSxJQUFJLEdBQUdzQixPQUFQLEdBQWlCQSxPQUFqQixHQUEyQnRCLElBQWxDO0FBQ0EsWUFBSXlELElBQUksR0FBRyxDQUFYO0FBQ0EsWUFBSUMsTUFBTSxHQUFHLENBQWI7O0FBQ0EsWUFBSS9CLElBQUksQ0FBQ1osSUFBTCxLQUFjLFVBQWxCLEVBQThCO0FBQzVCMEMsVUFBQUEsSUFBSSxHQUFHLEtBQUtjLFlBQUwsQ0FBa0JuQyxNQUFNLENBQUMsQ0FBRCxDQUF4QixDQUFQO0FBQ0FzQixVQUFBQSxNQUFNLEdBQUcsS0FBS2EsWUFBTCxDQUFrQm5DLE1BQU0sQ0FBQyxDQUFELENBQXhCLENBQVQ7QUFDRDs7QUFDRDNCLFFBQUFBLEtBQUssR0FBRyxJQUFJWixJQUFKLENBQVNtRSxJQUFULEVBQWVDLEtBQUssR0FBRyxDQUF2QixFQUEwQmpFLElBQTFCLEVBQWdDeUQsSUFBaEMsRUFBc0NDLE1BQXRDLENBQVI7QUFDRDs7QUFDRGpELE1BQUFBLEtBQUssR0FBRyxLQUFLaUMsWUFBTCxDQUFrQmpDLEtBQWxCLENBQVI7QUFFQSxXQUFLbUMsR0FBTCxDQUFTO0FBQUVmLFFBQUFBLFVBQVUsRUFBRXBCO0FBQWQsT0FBVCxFQUFnQyxNQUFLO0FBQ25DLGFBQUtvQyxpQkFBTCxDQUF1QnBDLEtBQXZCO0FBQ0EsYUFBS3FDLEtBQUwsQ0FBVyxPQUFYLEVBQW9CckMsS0FBcEI7QUFDQSxhQUFLcUMsS0FBTCxDQUFXLFFBQVgsRUFBcUIsSUFBckI7QUFDRCxPQUpEO0FBS0QsS0FwTE07O0FBc0xQbUMsSUFBQUEsY0FBYyxDQUFDM0MsS0FBRCxFQUFNO0FBQ2xCLGFBQU8sS0FBSzRDLFNBQUwsR0FBaUI1QyxLQUFqQixDQUFQO0FBQ0QsS0F4TE07O0FBMExQNkMsSUFBQUEsY0FBYyxDQUFDN0MsS0FBRCxFQUFRN0IsS0FBUixFQUFhO0FBQ3pCLFlBQU07QUFBRW1CLFFBQUFBLFdBQUY7QUFBZUksUUFBQUE7QUFBZixVQUEyQixLQUFLTCxJQUF0QztBQUNBQyxNQUFBQSxXQUFXLENBQUNVLEtBQUQsQ0FBWCxHQUFxQk4sT0FBTyxDQUFDTSxLQUFELENBQVAsQ0FBZThDLE9BQWYsQ0FBdUIzRSxLQUF2QixDQUFyQjtBQUNBLFdBQUttQyxHQUFMLENBQVM7QUFBRWhCLFFBQUFBO0FBQUYsT0FBVDtBQUNELEtBOUxNOztBQWdNUHlELElBQUFBLGVBQWUsQ0FBQy9DLEtBQUQsRUFBTTtBQUNuQixhQUFPLEtBQUtYLElBQUwsQ0FBVUssT0FBVixDQUFrQk0sS0FBbEIsQ0FBUDtBQUNELEtBbE1NOztBQW9NUGdELElBQUFBLGVBQWUsQ0FBQ2hELEtBQUQsRUFBUUYsTUFBUixFQUFjO0FBQzNCLFlBQU07QUFBRUosUUFBQUE7QUFBRixVQUFjLEtBQUtMLElBQXpCO0FBQ0FLLE1BQUFBLE9BQU8sQ0FBQ00sS0FBRCxDQUFQLEdBQWlCRixNQUFqQjtBQUNBLFdBQUtRLEdBQUwsQ0FBUztBQUFFWixRQUFBQTtBQUFGLE9BQVQ7QUFDRCxLQXhNTTs7QUEwTVBrRCxJQUFBQSxTQUFTLEdBQUE7QUFDUCxZQUFNO0FBQUV0RCxRQUFBQSxXQUFGO0FBQWVJLFFBQUFBO0FBQWYsVUFBMkIsS0FBS0wsSUFBdEM7QUFDQSxhQUFPQyxXQUFXLENBQUNPLEdBQVosQ0FBZ0IsQ0FBQzFCLEtBQUQsRUFBUTZCLEtBQVIsS0FBa0JOLE9BQU8sQ0FBQ00sS0FBRCxDQUFQLENBQWU3QixLQUFmLENBQWxDLENBQVA7QUFDRCxLQTdNTTs7QUErTVA4RSxJQUFBQSxTQUFTLENBQUNuRCxNQUFELEVBQU87QUFDZCxZQUFNO0FBQUVKLFFBQUFBO0FBQUYsVUFBYyxLQUFLTCxJQUF6QjtBQUNBLFdBQUtpQixHQUFMLENBQVM7QUFDUGhCLFFBQUFBLFdBQVcsRUFBRVEsTUFBTSxDQUFDRCxHQUFQLENBQVcsQ0FBQzFCLEtBQUQsRUFBUTZCLEtBQVIsS0FBa0JOLE9BQU8sQ0FBQ00sS0FBRCxDQUFQLENBQWU4QyxPQUFmLENBQXVCM0UsS0FBdkIsQ0FBN0I7QUFETixPQUFUO0FBR0QsS0FwTk07O0FBc05Qb0MsSUFBQUEsaUJBQWlCLENBQUNwQyxLQUFELEVBQU07QUFDckIsVUFBSTJCLE1BQU0sR0FBRyxFQUFiO0FBQ0EsWUFBTTtBQUFFRyxRQUFBQSxHQUFGO0FBQU9aLFFBQUFBO0FBQVAsVUFBZ0IsSUFBdEI7QUFDQSxZQUFNO0FBQUVLLFFBQUFBO0FBQUYsVUFBY0wsSUFBcEI7O0FBRUEsVUFBSUEsSUFBSSxDQUFDWixJQUFMLEtBQWMsTUFBbEIsRUFBMEI7QUFDeEIsY0FBTXlFLFlBQVksR0FBRy9FLEtBQUssQ0FBQ2tELEtBQU4sQ0FBWSxHQUFaLENBQXJCO0FBQ0F2QixRQUFBQSxNQUFNLEdBQUcsQ0FDUEosT0FBTyxDQUFDLENBQUQsQ0FBUCxDQUFXb0QsT0FBWCxDQUFtQkksWUFBWSxDQUFDLENBQUQsQ0FBL0IsQ0FETyxFQUVQeEQsT0FBTyxDQUFDLENBQUQsQ0FBUCxDQUFXb0QsT0FBWCxDQUFtQkksWUFBWSxDQUFDLENBQUQsQ0FBL0IsQ0FGTyxDQUFUO0FBSUQsT0FORCxNQU1PO0FBQ0wsY0FBTXhGLElBQUksR0FBRyxJQUFJSCxJQUFKLENBQVNZLEtBQVQsQ0FBYjtBQUNBMkIsUUFBQUEsTUFBTSxHQUFHLENBQ1BKLE9BQU8sQ0FBQyxDQUFELENBQVAsQ0FBV29ELE9BQVgsQ0FBbUIsR0FBR3BGLElBQUksQ0FBQ0YsV0FBTCxFQUFrQixFQUF4QyxDQURPLEVBRVBrQyxPQUFPLENBQUMsQ0FBRCxDQUFQLENBQVdvRCxPQUFYLENBQW1CN0MsR0FBRyxDQUFDdkMsSUFBSSxDQUFDbUUsUUFBTCxLQUFrQixDQUFuQixDQUF0QixDQUZPLENBQVQ7O0FBSUEsWUFBSXhDLElBQUksQ0FBQ1osSUFBTCxLQUFjLE1BQWxCLEVBQTBCO0FBQ3hCcUIsVUFBQUEsTUFBTSxDQUFDcUQsSUFBUCxDQUFZekQsT0FBTyxDQUFDLENBQUQsQ0FBUCxDQUFXb0QsT0FBWCxDQUFtQjdDLEdBQUcsQ0FBQ3ZDLElBQUksQ0FBQ29FLE9BQUwsRUFBRCxDQUF0QixDQUFaO0FBQ0Q7O0FBQ0QsWUFBSXpDLElBQUksQ0FBQ1osSUFBTCxLQUFjLFVBQWxCLEVBQThCO0FBQzVCcUIsVUFBQUEsTUFBTSxDQUFDcUQsSUFBUCxDQUNFekQsT0FBTyxDQUFDLENBQUQsQ0FBUCxDQUFXb0QsT0FBWCxDQUFtQjdDLEdBQUcsQ0FBQ3ZDLElBQUksQ0FBQ29FLE9BQUwsRUFBRCxDQUF0QixDQURGLEVBRUVwQyxPQUFPLENBQUMsQ0FBRCxDQUFQLENBQVdvRCxPQUFYLENBQW1CN0MsR0FBRyxDQUFDdkMsSUFBSSxDQUFDcUUsUUFBTCxFQUFELENBQXRCLENBRkYsRUFHRXJDLE9BQU8sQ0FBQyxDQUFELENBQVAsQ0FBV29ELE9BQVgsQ0FBbUI3QyxHQUFHLENBQUN2QyxJQUFJLENBQUNzRSxVQUFMLEVBQUQsQ0FBdEIsQ0FIRjtBQUtEO0FBQ0Y7O0FBRUQsV0FBSzFCLEdBQUwsQ0FBUztBQUFFaEIsUUFBQUEsV0FBVyxFQUFFUTtBQUFmLE9BQVQ7QUFDRDs7QUFwUE0sR0ExRkc7O0FBaVZac0QsRUFBQUEsT0FBTyxHQUFBO0FBQ0wsVUFBTTdELFVBQVUsR0FBRyxLQUFLYSxZQUFMLENBQWtCLEtBQUtmLElBQUwsQ0FBVWxCLEtBQTVCLENBQW5CO0FBQ0EsU0FBS21DLEdBQUwsQ0FBUztBQUFFZixNQUFBQTtBQUFGLEtBQVQsRUFBeUIsTUFBSztBQUM1QixXQUFLZ0IsaUJBQUwsQ0FBdUJoQixVQUF2QjtBQUNBLFdBQUtpQixLQUFMLENBQVcsT0FBWCxFQUFvQmpCLFVBQXBCO0FBQ0QsS0FIRDtBQUlEOztBQXZWVyxDQUFELENBQWIiLCJmaWxlIjoiZGF0ZXRpbWUtcGlja2VyL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3B1aUNvbXBvbmVudCB9IGZyb20gJy4uL2NvbW1vbi9jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBpc0RlZiB9IGZyb20gJy4uL2NvbW1vbi91dGlscyc7XHJcblxyXG5jb25zdCBjdXJyZW50WWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTtcclxuY29uc3QgaXNWYWxpZERhdGUgPSBkYXRlID0+IGlzRGVmKGRhdGUpICYmICFpc05hTihuZXcgRGF0ZShkYXRlKS5nZXRUaW1lKCkpO1xyXG5cclxuZnVuY3Rpb24gcmFuZ2UobnVtLCBtaW4sIG1heCkge1xyXG4gIHJldHVybiBNYXRoLm1pbihNYXRoLm1heChudW0sIG1pbiksIG1heCk7XHJcbn1cclxuXHJcblNwdWlDb21wb25lbnQoe1xyXG4gIHByb3BzOiB7XHJcbiAgICB2YWx1ZTogbnVsbCxcclxuICAgIHRpdGxlOiBTdHJpbmcsXHJcbiAgICBsb2FkaW5nOiBCb29sZWFuLFxyXG4gICAgaXRlbUhlaWdodDoge1xyXG4gICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgIHZhbHVlOiA0NFxyXG4gICAgfSxcclxuICAgIHZpc2libGVJdGVtQ291bnQ6IHtcclxuICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICB2YWx1ZTogNVxyXG4gICAgfSxcclxuICAgIGNvbmZpcm1CdXR0b25UZXh0OiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgdmFsdWU6ICfnoa7orqQnXHJcbiAgICB9LFxyXG4gICAgY2FuY2VsQnV0dG9uVGV4dDoge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIHZhbHVlOiAn5Y+W5raIJ1xyXG4gICAgfSxcclxuICAgIHR5cGU6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICB2YWx1ZTogJ2RhdGV0aW1lJ1xyXG4gICAgfSxcclxuICAgIHNob3dUb29sYmFyOiB7XHJcbiAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgIHZhbHVlOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgbWluRGF0ZToge1xyXG4gICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgIHZhbHVlOiBuZXcgRGF0ZShjdXJyZW50WWVhciAtIDEwLCAwLCAxKS5nZXRUaW1lKClcclxuICAgIH0sXHJcbiAgICBtYXhEYXRlOiB7XHJcbiAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgdmFsdWU6IG5ldyBEYXRlKGN1cnJlbnRZZWFyICsgMTAsIDExLCAzMSkuZ2V0VGltZSgpXHJcbiAgICB9LFxyXG4gICAgbWluSG91cjoge1xyXG4gICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgIHZhbHVlOiAwXHJcbiAgICB9LFxyXG4gICAgbWF4SG91cjoge1xyXG4gICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgIHZhbHVlOiAyM1xyXG4gICAgfSxcclxuICAgIG1pbk1pbnV0ZToge1xyXG4gICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgIHZhbHVlOiAwXHJcbiAgICB9LFxyXG4gICAgbWF4TWludXRlOiB7XHJcbiAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgdmFsdWU6IDU5XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgZGF0YToge1xyXG4gICAgcGlja2VyVmFsdWU6IFtdLFxyXG4gICAgaW5uZXJWYWx1ZTogRGF0ZS5ub3coKVxyXG4gIH0sXHJcblxyXG4gIGNvbXB1dGVkOiB7XHJcbiAgICBjb2x1bW5zKCkge1xyXG4gICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5nZXRSYW5nZXMoKS5tYXAoKHsgdHlwZSwgcmFuZ2UgfSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IHRoaXMudGltZXMocmFuZ2VbMV0gLSByYW5nZVswXSArIDEsIGluZGV4ID0+IHtcclxuICAgICAgICAgIGxldCB2YWx1ZSA9IHJhbmdlWzBdICsgaW5kZXg7XHJcbiAgICAgICAgICB2YWx1ZSA9IHR5cGUgPT09ICd5ZWFyJyA/IGAke3ZhbHVlfWAgOiB0aGlzLnBhZCh2YWx1ZSk7XHJcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB2YWx1ZXM7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgd2F0Y2g6IHtcclxuICAgIHZhbHVlKHZhbCkge1xyXG4gICAgICBjb25zdCB7IGRhdGEgfSA9IHRoaXM7XHJcbiAgICAgIHZhbCA9IHRoaXMuY29ycmVjdFZhbHVlKHZhbCk7XHJcbiAgICAgIGNvbnN0IGlzRXF1YWwgPSB2YWwgPT09IGRhdGEuaW5uZXJWYWx1ZTtcclxuICAgICAgaWYgKCFpc0VxdWFsKSB7XHJcbiAgICAgICAgdGhpcy5zZXQoeyBpbm5lclZhbHVlOiB2YWwgfSwgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy51cGRhdGVDb2x1bW5WYWx1ZSh2YWwpO1xyXG4gICAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB2YWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgbWV0aG9kczoge1xyXG4gICAgZ2V0UmFuZ2VzKCk6IG9iamVjdFtdIHtcclxuICAgICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzO1xyXG4gICAgICBpZiAoZGF0YS50eXBlID09PSAndGltZScpIHtcclxuICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICB0eXBlOiAnaG91cicsXHJcbiAgICAgICAgICAgIHJhbmdlOiBbZGF0YS5taW5Ib3VyLCBkYXRhLm1heEhvdXJdXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICB0eXBlOiAnbWludXRlJyxcclxuICAgICAgICAgICAgcmFuZ2U6IFtkYXRhLm1pbk1pbnV0ZSwgZGF0YS5tYXhNaW51dGVdXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBtYXhZZWFyLCBtYXhEYXRlLCBtYXhNb250aCwgbWF4SG91ciwgbWF4TWludXRlIH0gPSB0aGlzLmdldEJvdW5kYXJ5KCdtYXgnLCBkYXRhLmlubmVyVmFsdWUpO1xyXG4gICAgICBjb25zdCB7IG1pblllYXIsIG1pbkRhdGUsIG1pbk1vbnRoLCBtaW5Ib3VyLCBtaW5NaW51dGUgfSA9IHRoaXMuZ2V0Qm91bmRhcnkoJ21pbicsIGRhdGEuaW5uZXJWYWx1ZSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ3llYXInLFxyXG4gICAgICAgICAgcmFuZ2U6IFttaW5ZZWFyLCBtYXhZZWFyXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ21vbnRoJyxcclxuICAgICAgICAgIHJhbmdlOiBbbWluTW9udGgsIG1heE1vbnRoXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ2RheScsXHJcbiAgICAgICAgICByYW5nZTogW21pbkRhdGUsIG1heERhdGVdXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAnaG91cicsXHJcbiAgICAgICAgICByYW5nZTogW21pbkhvdXIsIG1heEhvdXJdXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAnbWludXRlJyxcclxuICAgICAgICAgIHJhbmdlOiBbbWluTWludXRlLCBtYXhNaW51dGVdXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ2RhdGUnKSByZXN1bHQuc3BsaWNlKDMsIDIpO1xyXG4gICAgICBpZiAoZGF0YS50eXBlID09PSAneWVhci1tb250aCcpIHJlc3VsdC5zcGxpY2UoMiwgMyk7XHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9LFxyXG5cclxuICAgIHBhZCh2YWw6IHN0cmluZyB8IG51bWJlcik6IHN0cmluZyB7XHJcbiAgICAgIHJldHVybiBgMDAke3ZhbH1gLnNsaWNlKC0yKTtcclxuICAgIH0sXHJcblxyXG4gICAgY29ycmVjdFZhbHVlKHZhbHVlKSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YSwgcGFkIH0gPSB0aGlzO1xyXG4gICAgICAvLyB2YWxpZGF0ZSB2YWx1ZVxyXG4gICAgICBjb25zdCBpc0RhdGVUeXBlID0gZGF0YS50eXBlICE9PSAndGltZSc7XHJcbiAgICAgIGlmIChpc0RhdGVUeXBlICYmICFpc1ZhbGlkRGF0ZSh2YWx1ZSkpIHtcclxuICAgICAgICB2YWx1ZSA9IGRhdGEubWluRGF0ZTtcclxuICAgICAgfSBlbHNlIGlmICghaXNEYXRlVHlwZSAmJiAhdmFsdWUpIHtcclxuICAgICAgICBjb25zdCB7IG1pbkhvdXIgfSA9IGRhdGE7XHJcbiAgICAgICAgdmFsdWUgPSBgJHtwYWQobWluSG91cil9OjAwYDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gdGltZSB0eXBlXHJcbiAgICAgIGlmICghaXNEYXRlVHlwZSkge1xyXG4gICAgICAgIGxldCBbaG91ciwgbWludXRlXSA9IHZhbHVlLnNwbGl0KCc6Jyk7XHJcbiAgICAgICAgaG91ciA9IHBhZChyYW5nZShob3VyLCBkYXRhLm1pbkhvdXIsIGRhdGEubWF4SG91cikpO1xyXG4gICAgICAgIG1pbnV0ZSA9IHBhZChyYW5nZShtaW51dGUsIGRhdGEubWluTWludXRlLCBkYXRhLm1heE1pbnV0ZSkpO1xyXG5cclxuICAgICAgICByZXR1cm4gYCR7aG91cn06JHttaW51dGV9YDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gZGF0ZSB0eXBlXHJcbiAgICAgIHZhbHVlID0gTWF0aC5tYXgodmFsdWUsIGRhdGEubWluRGF0ZSk7XHJcbiAgICAgIHZhbHVlID0gTWF0aC5taW4odmFsdWUsIGRhdGEubWF4RGF0ZSk7XHJcblxyXG4gICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9LFxyXG5cclxuICAgIHRpbWVzKG46IG51bWJlciwgaXRlcmF0ZWU6IChudW1iZXIpID0+IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgICAgbGV0IGluZGV4ID0gLTE7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IEFycmF5KG4pO1xyXG5cclxuICAgICAgd2hpbGUgKCsraW5kZXggPCBuKSB7XHJcbiAgICAgICAgcmVzdWx0W2luZGV4XSA9IGl0ZXJhdGVlKGluZGV4KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfSxcclxuXHJcbiAgICBnZXRCb3VuZGFyeSh0eXBlOiBzdHJpbmcsIGlubmVyVmFsdWU6IG51bWJlcik6IG9iamVjdCB7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0gbmV3IERhdGUoaW5uZXJWYWx1ZSk7XHJcbiAgICAgIGNvbnN0IGJvdW5kYXJ5ID0gbmV3IERhdGUodGhpcy5kYXRhW2Ake3R5cGV9RGF0ZWBdKTtcclxuICAgICAgY29uc3QgeWVhciA9IGJvdW5kYXJ5LmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgIGxldCBtb250aCA9IDE7XHJcbiAgICAgIGxldCBkYXRlID0gMTtcclxuICAgICAgbGV0IGhvdXIgPSAwO1xyXG4gICAgICBsZXQgbWludXRlID0gMDtcclxuXHJcbiAgICAgIGlmICh0eXBlID09PSAnbWF4Jykge1xyXG4gICAgICAgIG1vbnRoID0gMTI7XHJcbiAgICAgICAgZGF0ZSA9IHRoaXMuZ2V0TW9udGhFbmREYXkodmFsdWUuZ2V0RnVsbFllYXIoKSwgdmFsdWUuZ2V0TW9udGgoKSArIDEpO1xyXG4gICAgICAgIGhvdXIgPSAyMztcclxuICAgICAgICBtaW51dGUgPSA1OTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHZhbHVlLmdldEZ1bGxZZWFyKCkgPT09IHllYXIpIHtcclxuICAgICAgICBtb250aCA9IGJvdW5kYXJ5LmdldE1vbnRoKCkgKyAxO1xyXG4gICAgICAgIGlmICh2YWx1ZS5nZXRNb250aCgpICsgMSA9PT0gbW9udGgpIHtcclxuICAgICAgICAgIGRhdGUgPSBib3VuZGFyeS5nZXREYXRlKCk7XHJcbiAgICAgICAgICBpZiAodmFsdWUuZ2V0RGF0ZSgpID09PSBkYXRlKSB7XHJcbiAgICAgICAgICAgIGhvdXIgPSBib3VuZGFyeS5nZXRIb3VycygpO1xyXG4gICAgICAgICAgICBpZiAodmFsdWUuZ2V0SG91cnMoKSA9PT0gaG91cikge1xyXG4gICAgICAgICAgICAgIG1pbnV0ZSA9IGJvdW5kYXJ5LmdldE1pbnV0ZXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBbYCR7dHlwZX1ZZWFyYF06IHllYXIsXHJcbiAgICAgICAgW2Ake3R5cGV9TW9udGhgXTogbW9udGgsXHJcbiAgICAgICAgW2Ake3R5cGV9RGF0ZWBdOiBkYXRlLFxyXG4gICAgICAgIFtgJHt0eXBlfUhvdXJgXTogaG91cixcclxuICAgICAgICBbYCR7dHlwZX1NaW51dGVgXTogbWludXRlXHJcbiAgICAgIH07XHJcbiAgICB9LFxyXG5cclxuICAgIGdldFRydWVWYWx1ZShmb3JtYXR0ZWRWYWx1ZTogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgICAgaWYgKCFmb3JtYXR0ZWRWYWx1ZSkgcmV0dXJuO1xyXG4gICAgICB3aGlsZSAoaXNOYU4ocGFyc2VJbnQoZm9ybWF0dGVkVmFsdWUsIDEwKSkpIHtcclxuICAgICAgICBmb3JtYXR0ZWRWYWx1ZSA9IGZvcm1hdHRlZFZhbHVlLnNsaWNlKDEpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBwYXJzZUludChmb3JtYXR0ZWRWYWx1ZSwgMTApO1xyXG4gICAgfSxcclxuXHJcbiAgICBnZXRNb250aEVuZERheSh5ZWFyLCBtb250aCk6IG51bWJlciB7XHJcbiAgICAgIHJldHVybiAzMiAtIG5ldyBEYXRlKHllYXIsIG1vbnRoIC0gMSwgMzIpLmdldERhdGUoKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25DYW5jZWwoKSB7XHJcbiAgICAgIHRoaXMuJGVtaXQoJ2NhbmNlbCcpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvbkNvbmZpcm0oKTogdm9pZCB7XHJcbiAgICAgIHRoaXMuJGVtaXQoJ2NvbmZpcm0nLCB0aGlzLmRhdGEuaW5uZXJWYWx1ZSk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ2hhbmdlKGV2ZW50OiBXZWFwcC5FdmVudCk6IHZvaWQge1xyXG4gICAgICBjb25zdCB7IGRhdGEgfSA9IHRoaXM7XHJcbiAgICAgIGNvbnN0IHBpY2tlclZhbHVlID0gZXZlbnQuZGV0YWlsLnZhbHVlO1xyXG4gICAgICBjb25zdCB2YWx1ZXMgPSBwaWNrZXJWYWx1ZVxyXG4gICAgICAgIC5zbGljZSgwLCBkYXRhLmNvbHVtbnMubGVuZ3RoKVxyXG4gICAgICAgIC5tYXAoKHZhbHVlLCBpbmRleCkgPT4gZGF0YS5jb2x1bW5zW2luZGV4XVt2YWx1ZV0pO1xyXG4gICAgICBsZXQgdmFsdWU7XHJcblxyXG4gICAgICBpZiAoZGF0YS50eXBlID09PSAndGltZScpIHtcclxuICAgICAgICB2YWx1ZSA9IHZhbHVlcy5qb2luKCc6Jyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgeWVhciA9IHRoaXMuZ2V0VHJ1ZVZhbHVlKHZhbHVlc1swXSk7XHJcbiAgICAgICAgY29uc3QgbW9udGggPSB0aGlzLmdldFRydWVWYWx1ZSh2YWx1ZXNbMV0pO1xyXG4gICAgICAgIGNvbnN0IG1heERhdGUgPSB0aGlzLmdldE1vbnRoRW5kRGF5KHllYXIsIG1vbnRoKTtcclxuICAgICAgICBsZXQgZGF0ZSA9IHRoaXMuZ2V0VHJ1ZVZhbHVlKHZhbHVlc1syXSk7XHJcbiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ3llYXItbW9udGgnKSB7XHJcbiAgICAgICAgICBkYXRlID0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGF0ZSA9IGRhdGUgPiBtYXhEYXRlID8gbWF4RGF0ZSA6IGRhdGU7XHJcbiAgICAgICAgbGV0IGhvdXIgPSAwO1xyXG4gICAgICAgIGxldCBtaW51dGUgPSAwO1xyXG4gICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICdkYXRldGltZScpIHtcclxuICAgICAgICAgIGhvdXIgPSB0aGlzLmdldFRydWVWYWx1ZSh2YWx1ZXNbM10pO1xyXG4gICAgICAgICAgbWludXRlID0gdGhpcy5nZXRUcnVlVmFsdWUodmFsdWVzWzRdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFsdWUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRhdGUsIGhvdXIsIG1pbnV0ZSk7XHJcbiAgICAgIH1cclxuICAgICAgdmFsdWUgPSB0aGlzLmNvcnJlY3RWYWx1ZSh2YWx1ZSk7XHJcblxyXG4gICAgICB0aGlzLnNldCh7IGlubmVyVmFsdWU6IHZhbHVlIH0sICgpID0+IHtcclxuICAgICAgICB0aGlzLnVwZGF0ZUNvbHVtblZhbHVlKHZhbHVlKTtcclxuICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHZhbHVlKTtcclxuICAgICAgICB0aGlzLiRlbWl0KCdjaGFuZ2UnLCB0aGlzKTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGdldENvbHVtblZhbHVlKGluZGV4KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlcygpW2luZGV4XTtcclxuICAgIH0sXHJcblxyXG4gICAgc2V0Q29sdW1uVmFsdWUoaW5kZXgsIHZhbHVlKSB7XHJcbiAgICAgIGNvbnN0IHsgcGlja2VyVmFsdWUsIGNvbHVtbnMgfSA9IHRoaXMuZGF0YTtcclxuICAgICAgcGlja2VyVmFsdWVbaW5kZXhdID0gY29sdW1uc1tpbmRleF0uaW5kZXhPZih2YWx1ZSk7XHJcbiAgICAgIHRoaXMuc2V0KHsgcGlja2VyVmFsdWUgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGdldENvbHVtblZhbHVlcyhpbmRleCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5kYXRhLmNvbHVtbnNbaW5kZXhdO1xyXG4gICAgfSxcclxuXHJcbiAgICBzZXRDb2x1bW5WYWx1ZXMoaW5kZXgsIHZhbHVlcykge1xyXG4gICAgICBjb25zdCB7IGNvbHVtbnMgfSA9IHRoaXMuZGF0YTtcclxuICAgICAgY29sdW1uc1tpbmRleF0gPSB2YWx1ZXM7XHJcbiAgICAgIHRoaXMuc2V0KHsgY29sdW1ucyB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgZ2V0VmFsdWVzKCkge1xyXG4gICAgICBjb25zdCB7IHBpY2tlclZhbHVlLCBjb2x1bW5zIH0gPSB0aGlzLmRhdGE7XHJcbiAgICAgIHJldHVybiBwaWNrZXJWYWx1ZS5tYXAoKHZhbHVlLCBpbmRleCkgPT4gY29sdW1uc1tpbmRleF1bdmFsdWVdKTtcclxuICAgIH0sXHJcblxyXG4gICAgc2V0VmFsdWVzKHZhbHVlcykge1xyXG4gICAgICBjb25zdCB7IGNvbHVtbnMgfSA9IHRoaXMuZGF0YTtcclxuICAgICAgdGhpcy5zZXQoe1xyXG4gICAgICAgIHBpY2tlclZhbHVlOiB2YWx1ZXMubWFwKCh2YWx1ZSwgaW5kZXgpID0+IGNvbHVtbnNbaW5kZXhdLmluZGV4T2YodmFsdWUpKVxyXG4gICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgdXBkYXRlQ29sdW1uVmFsdWUodmFsdWUpOiB2b2lkIHtcclxuICAgICAgbGV0IHZhbHVlcyA9IFtdO1xyXG4gICAgICBjb25zdCB7IHBhZCwgZGF0YSB9ID0gdGhpcztcclxuICAgICAgY29uc3QgeyBjb2x1bW5zIH0gPSBkYXRhO1xyXG5cclxuICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ3RpbWUnKSB7XHJcbiAgICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gdmFsdWUuc3BsaXQoJzonKTtcclxuICAgICAgICB2YWx1ZXMgPSBbXHJcbiAgICAgICAgICBjb2x1bW5zWzBdLmluZGV4T2YoY3VycmVudFZhbHVlWzBdKSxcclxuICAgICAgICAgIGNvbHVtbnNbMV0uaW5kZXhPZihjdXJyZW50VmFsdWVbMV0pXHJcbiAgICAgICAgXTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodmFsdWUpO1xyXG4gICAgICAgIHZhbHVlcyA9IFtcclxuICAgICAgICAgIGNvbHVtbnNbMF0uaW5kZXhPZihgJHtkYXRlLmdldEZ1bGxZZWFyKCl9YCksXHJcbiAgICAgICAgICBjb2x1bW5zWzFdLmluZGV4T2YocGFkKGRhdGUuZ2V0TW9udGgoKSArIDEpKVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ2RhdGUnKSB7XHJcbiAgICAgICAgICB2YWx1ZXMucHVzaChjb2x1bW5zWzJdLmluZGV4T2YocGFkKGRhdGUuZ2V0RGF0ZSgpKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGF0YS50eXBlID09PSAnZGF0ZXRpbWUnKSB7XHJcbiAgICAgICAgICB2YWx1ZXMucHVzaChcclxuICAgICAgICAgICAgY29sdW1uc1syXS5pbmRleE9mKHBhZChkYXRlLmdldERhdGUoKSkpLFxyXG4gICAgICAgICAgICBjb2x1bW5zWzNdLmluZGV4T2YocGFkKGRhdGUuZ2V0SG91cnMoKSkpLFxyXG4gICAgICAgICAgICBjb2x1bW5zWzRdLmluZGV4T2YocGFkKGRhdGUuZ2V0TWludXRlcygpKSlcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnNldCh7IHBpY2tlclZhbHVlOiB2YWx1ZXMgfSk7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgY3JlYXRlZCgpIHtcclxuICAgIGNvbnN0IGlubmVyVmFsdWUgPSB0aGlzLmNvcnJlY3RWYWx1ZSh0aGlzLmRhdGEudmFsdWUpO1xyXG4gICAgdGhpcy5zZXQoeyBpbm5lclZhbHVlIH0sICgpID0+IHtcclxuICAgICAgdGhpcy51cGRhdGVDb2x1bW5WYWx1ZShpbm5lclZhbHVlKTtcclxuICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCBpbm5lclZhbHVlKTtcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcbiJdfQ==
